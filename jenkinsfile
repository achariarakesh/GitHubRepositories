node {
	def workspace = pwd();
	def solutionfolderpath = workspace + "\\TestWebSolution\\TestWebSolution.sln";
	def testProjectfilepath = workspace + "\\TestWebSolution\\NUnitTestProject\\bin\\Release\\NUnitTestProject.dll";
	def publishfolderpath = workspace + "C:\\Jenkinsdeploy\\WebPipeline";

	
       	stage('Compile'){
	   echo "Compiling.."
	   bat "\"C:\\nuget\\nuget.exe\" restore ${solutionfolderpath}"
	   bat "\"${tool 'MSBuildLocal'}\" ${solutionfolderpath} /p:DeployOnBuild=false /p:SkipInvalidConfigurations=true /t:build /p:Configuration=Release /p:Platform=\"Any CPU\" /p:DeleteExistingFiles=True"
 	}
	
	stage('Unittest'){
           echo "Unit test.."
	    try{
	        
	        dir('testresults') 
		{
		  deleteDir()
		}
		
	        bat('MKDIR testresults')
		
	        bat "\"C:\\PROGRA~2\\NUnit.org\\nunit-console\\nunit3-console.exe\" ${testProjectfilepath} --result=./testresults/TestResult.xml;format=nunit2" 
	    }
	    finally{
	       step([$class: 'NUnitPublisher', testResultsPattern: 'testresults/*.xml', debug: false, failIfNoResults: true])
	    }
	}
	
	stage('Deploy')
	{
	    echo "Deploy.."
	    bat "\"${tool 'MSBuildLocal'}\" ${solutionfolderpath} /p:DeployOnBuild=true /p:DeployDefaultTarget=WebPublish /p:WebPublishMethod=FileSystem /p:SkipInvalidConfigurations=true /t:build /p:Configuration=Release /p:Platform=\"Any CPU\" /p:DeleteExistingFiles=True /p:publishUrl=${publishfolderpath}"
	}
	
	stage('Clear')
	{
	   echo "Clearing  work space.."
	   cleanWs()
	}
}

